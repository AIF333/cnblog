<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>blog 登录</title>
    <link rel="stylesheet" href="/static/dist/css/bootstrap.css">
    <link rel="stylesheet" href="/static/css/login.css">
    <script src="/static/jquery-3.3.1.js"></script>

</head>
<body>

{% csrf_token %}

<div class="login_h container">
    <form class="col-md-4 col-md-offset-2 ">

          <div class="form-group">
            <label for="username">用户名</label>
{#            <input type="text" class="form-control" id="user" placeholder="请输入用户名">#}
              {{ regForm.username }}<span></span>

          </div>
          <div class="form-group">
            <label for="password">密码</label>
              {{ regForm.password }}<span></span>
          </div>
          <div class="form-group">
            <label for="reptpwd">确认密码</label>
            {{ regForm.reptpwd }}<span></span>
          </div>
          <div class="form-group">
            <label for="email">邮箱</label>
            {{ regForm.email }}<span></span>
          </div>

           <button type="button" class="btn btn-primary regBtn">提交</button>
    </form>
</div>

<script>

    var token=$("input[name=csrfmiddlewaretoken]").val();
    $(".regBtn").click(function () {
        $.ajax({
            url:"/reg/",
            type:"POST",
            data:{
                csrfmiddlewaretoken:token,
                username:$("#username").val(),
                password:$("#password").val(),
                reptpwd:$("#reptpwd").val(),
                email:$("#email").val()
            },
            success:function (data) {
                var data=JSON.parse(data);
                console.log(data);

                if (data.user){
                    alert("恭喜注册成功！");
                    location.href="/login/";
                }

                else{
                    //先初始化错误信息
                    $("#username").next().html("")
                    $("#password").next().html("")
                    $("#reptpwd").next().html("")
                    $("#email").next().html("")

                    var errdict=data.errormsg;   //错误信息列表 email: ["Ensure this value has at least 5 characters (it has 3)."]
                    $.each(errdict,function (errkey,errlist) {
                        //console.log(i,j);
                        $("#"+errkey).next().addClass("pull-right").html(errlist[0]).css("color","red").css("font-size","12px")
                    })
                }

            }

        })

    })

</script>

</body>
</html>